<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.tracom.mapper.SI.SI0104Mapper">

	<select id="SI0104G0R0" parameterType="Map" resultType="Map">
		SELECT 		A.MTRL_ID
				,	A.MTRL_NM
				,	A.MTRL_CD
				,	DL1.DL_CD_NM AS MTRL_CD_CD
				,	A.MAKER_ID
				,	DL3.DL_CD_NM AS MAKER_ID_CD <!-- 임시 -->
				,	A.DVC_KIND
				,	DL2.DL_CD_NM AS DVC_KIND_CD
				,	A.APPR_IVNT_CNT
				,	A.CUR_IVNT_CNT
				,	A.REMARK
				,	A.UPD_ID
				,	DATE_FORMAT(A.UPD_DTM,'%Y-%m-%d') UPD_DTM
				
		FROM		SLT_MTRL_MST A
		LEFT JOIN	PLF_DL_CD_INFO DL1
			ON		A.MTRL_CD = DL1.DL_CD
			AND		DL1.CO_CD = 'MTRL_CD'
		LEFT JOIN	PLF_DL_CD_INFO DL2
			ON		A.DVC_KIND = DL2.DL_CD
			AND		DL2.CO_CD = 'DVC_KIND'
		LEFT JOIN	PLF_DL_CD_INFO DL3
			ON		A.MAKER_ID = DL3.DL_CD
			AND		DL3.CO_CD = 'MAKER_ID'					
		<where>
			<if test= "CONTENT != null and CONTENT != ''">
				MTRL_ID LIKE CONCAT('%',#{CONTENT},'%') || MTRL_NM LIKE CONCAT('%',#{CONTENT},'%')
			</if>
		</where>	
	
	</select>
	
	<select id="SI0104G1R0" parameterType="Map" resultType="Map">
		SELECT 		A.MTRL_HIS_ID	
				,	DATE_FORMAT(A.UPD_DTM,'%Y-%m-%d') UPD_DTM
				,	A.MTRL_ID
				,	B.MTRL_NM
				,	A.INCM_DIV
				,	DL1.DL_CD_NM AS INCM_DIV_CD
				,	A.QUANTITY
				,	A.REASON
				
		FROM		SLT_MTRL_HIS A
		LEFT JOIN	SLT_MTRL_MST B
			ON		A.MTRL_ID = B.MTRL_ID
		LEFT JOIN	PLF_DL_CD_INFO DL1
			ON		A.INCM_DIV = DL1.DL_CD
			AND		DL1.CO_CD = 'INCM_DIV'			
		<where>
			<if test= "CONTENT != null and CONTENT != ''">
				MTRL_ID LIKE CONCAT('%',#{CONTENT},'%') || MTRL_NM LIKE CONCAT('%',#{CONTENT},'%')
			</if>
		</where>	
		ORDER BY	A.MTRL_HIS_ID DESC
	</select>
	
	<select id="SI0104G1K0" resultType="Map">
		SELECT CONCAT('MH', LPAD(NEXTVAL(SEQ_SLT_MTRL_HIS_0), 8, '0')) AS 'SEQ'
	</select>	
	
	<insert id="SI0104G1I0" parameterType="Map">
		INSERT INTO	SLT_MTRL_HIS
				(
					MTRL_HIS_ID
				,	UPD_DTM
				,	MTRL_ID
				,	INCM_DIV
				,	QUANTITY
				,	REASON			
				)
				
		VALUES (
					#{MTRL_HIS_ID}
				,	#{UPD_DTM}
				,	#{MTRL_ID}
				,	#{INCM_DIV}
				,	#{QUANTITY}
				,	#{REASON}				
				)		
	</insert>
	
	<update id="SI0104G0U0" parameterType="Map">
		UPDATE  	SLT_MTRL_MST
		SET			CUR_IVNT_CNT = #{CUR_IVNT_CNT}
				
		WHERE		MTRL_ID = #{MTRL_ID}	
	</update>
	
	<update id="SI0104G1U0" parameterType="Map">
		UPDATE  	SLT_MTRL_HIS
		SET		
					
				,	INCM_DIV = #{INCM_DIV}
				,	QUANTITY = #{QUANTITY}
				,	REASON = #{REASON}		
				
		WHERE		UPD_DTM = #{UPD_DTM}
		AND			MTRL_ID = #{MTRL_ID}	
	</update>
	
	<delete id="SI0104G1D0" parameterType="Map">
		DELETE
		FROM		SLT_MTRL_HIS
		WHERE		UPD_DTM = #{UPD_DTM}
		AND			MTRL_ID = #{MTRL_ID}
	
	</delete>

</mapper>
