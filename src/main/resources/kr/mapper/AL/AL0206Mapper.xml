<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.tracom.mapper.AL0206.AL0206Mapper">

<select id="AL0206G0R0" resultType="Map">
	SELECT A.ROUT_GRP,
			A.ROUT_ID,
			A.DAY_DIV,
			A.WAY_DIV,
			A.OPER_SN,
			A.ALLOC_NO,
			A.COR_ID,
			A.REST_TM,
			A.ROUT_ST_TM,
			A.ROUT_ED_TM,
			A.UPD_DTM,
			A.UPD_ID,
			RG.DL_CD_NM AS ROUT_GRP_NM,
			B.WAY_ASC_NM,
			B.WAY_DESC_NM,
			C.ROUT_NM,
			C.ROAT_TM,
			D.COR_NM,
			D.COR_COLOR
			,F.VHC_ID
			,F.VHC_NO
			,I.VHC_ID AS SEC_VHC_ID
			,I.VHC_NO AS SEC_VHC_NO
			,H.DRV_ID
			,H.DRV_NM
			,(SELECT DRV_ID FROM BMS_DRV_MST S WHERE G.SEC_DRV_ID = S.DRV_ID) AS SEC_DRV_ID
			,(SELECT DRV_NM FROM BMS_DRV_MST S WHERE G.SEC_DRV_ID = S.DRV_ID) AS SEC_DRV_NM
		FROM BMS_OPER_ALLOC_PL_ROUT_INFO A
			LEFT JOIN BMS_DL_CD_INFO RG
			ON A.ROUT_GRP = RG.DL_CD AND RG.CO_CD = 'ROUT_GRP'
			LEFT OUTER JOIN BMS_ROUT_MST C
				ON A.ROUT_ID = C.ROUT_ID AND C.DEL_YN != 'Y'
			LEFT OUTER JOIN BMS_COR_MST D
				ON A.COR_ID = D.COR_ID 
			LEFT JOIN BMS_ALLOC_PL_MST E
				ON A.ROUT_GRP = E.ROUT_GRP
				AND A.DAY_DIV = E.DAY_DIV
				AND A.ALLOC_NO = E.ALLOC_NO
				AND A.WAY_DIV = E.WAY_DIV
			LEFT JOIN BMS_VHC_MST F
				ON E.VHC_ID = F.VHC_ID
			LEFT JOIN BMS_VHC_MST I
				ON E.SEC_VHC_ID = I.VHC_ID
			LEFT JOIN BMS_DRV_ALLOC_INFO G
				ON A.ROUT_GRP = G.ROUT_GRP
				AND A.DAY_DIV = G.DAY_DIV
				AND A.ALLOC_NO = G.ALLOC_NO 
			LEFT JOIN BMS_DRV_MST H
				ON G.DRV_ID = H.DRV_ID
		WHERE A.ROUT_GRP = #{ROUT_GRP}
			AND A.DAY_DIV = #{DAY_DIV}
			<if test="@kr.tracom.util.CommonUtil@notEmpty(CONTENT1)">
			AND (H.DRV_NM LIKE CONCAT('%',#{CONTENT1},'%') OR F.VHC_NO LIKE CONCAT('%',#{CONTENT1},'%'))
			</if>
			ORDER BY ROUT_GRP, DAY_DIV, ALLOC_NO, OPER_SN
</select>

<select id="AL0206G0CNT" resultType="Map">
		SELECT COUNT(*) CNT
		FROM BMS_OPER_ALLOC_PL_ROUT_INFO
		WHERE ROUT_GRP = #{ROUT_GRP} AND DAY_DIV = #{DAY_DIV}
		GROUP BY ROUT_GRP, DAY_DIV, ALLOC_NO 
		ORDER BY ROUT_GRP, DAY_DIV, ALLOC_NO
</select>


</mapper>
