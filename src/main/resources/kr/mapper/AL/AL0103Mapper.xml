<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.tracom.mapper.AL0103.AL0103Mapper">

<select id="AL0103G0R0" resultType="Map">
	SELECT			A.COR_ID
				,	A.ROUT_GRP
				,	A.COR_NM
				,	A.COR_TYPE
				,	DL1.DL_CD_NM AS COR_TYPE_NM
				,	A.MOVE_TM
				,	A.COR_COLOR
				,	A.REMARK
				,	DL2.DL_CD_NM AS ROUT_GRP_NM
	FROM			BMS_COR_MST A
	LEFT OUTER JOIN BMS_DL_CD_INFO DL1
	ON	A.COR_TYPE = DL1.DL_CD AND DL1.CO_CD = 'COR_TYPE'
	LEFT JOIN		BMS_DL_CD_INFO DL2
	ON				A.ROUT_GRP = DL2.DL_CD AND DL2.CO_CD = 'ROUT_GRP'
	<where>
		<if test="@kr.tracom.util.CommonUtil@notEmpty(CONTENT)">
			<if test="TYPE == 'ALL'">
				AND (COR_ID LIKE CONCAT('%',#{CONTENT},'%') || COR_NM LIKE CONCAT('%',#{CONTENT},'%'))
			</if>
			<if test="TYPE == 'COR_ID'">
				AND COR_ID LIKE CONCAT('%',#{CONTENT},'%')
			</if>
			<if test="TYPE == 'COR_NM'">
				AND COR_NM LIKE CONCAT('%',#{CONTENT},'%') 
			</if>
		</if>
	</where>
	ORDER BY A.COR_ID
</select>

<select id="AL0103G0K0" resultType="Map">
	SELECT CONCAT('CO', LPAD(NEXTVAL(SEQ_BMS_COR_MST_0), 8, '0')) AS 'SEQ'
</select>

<select id="AL0103SHI0" resultType="Map">
	SELECT			COR_ID
				,	COR_NM
	FROM			BMS_COR_MST
	ORDER BY		COR_ID
</select>

<insert id="AL0103G0I0" parameterType="Map">
	INSERT	INTO	BMS_COR_MST
					(
					COR_ID
					,ROUT_GRP
					,COR_NM
					,COR_TYPE
					,MOVE_TM
					,COR_COLOR
					,REMARK
					,UPD_DTM
					,UPD_ID				
					)
			
	VALUES			
					(
					#{COR_ID}
					,#{ROUT_GRP}
					,#{COR_NM}
					,#{COR_TYPE}
					,#{MOVE_TM}
					,#{COR_COLOR}
					,#{REMARK}
					,#{UPD_DTM}
					,#{SSN_USER_ID}					
					)				

</insert>

<update id="AL0103G0U0" parameterType="Map">
	UPDATE			BMS_COR_MST
	
	SET				ROUT_GRP = #{ROUT_GRP}
					,COR_NM = #{COR_NM}
					,COR_TYPE = #{COR_TYPE}
					,MOVE_TM = #{MOVE_TM}
					,COR_COLOR = #{COR_COLOR}
					,REMARK = #{REMARK}
					,UPD_DTM = #{UPD_DTM}
					,UPD_ID	= #{SSN_USER_ID}
					
	WHERE			 COR_ID = #{COR_ID}
</update>

<delete id="AL0103G0D0" parameterType="Map">
	DELETE	FROM	 BMS_COR_DTL_INFO
	WHERE			 COR_ID = #{COR_ID};
	
	DELETE	FROM	 BMS_COR_MST
	WHERE			 COR_ID = #{COR_ID}
</delete>

<select id="AL0103G1R0" resultType="Map">
	SELECT			A.COR_ID
				,	A.REST_TM
				,	A.ROUT_SN
				,	A.COR_DTL_COLOR
				,	B.ROUT_ID
				,	B.ROUT_NM
				,	B.ROUT_TYPE
				,	B.STTN_CNT
				,	B.ROUT_LEN
				,	B.CURVATURE
				,	B.JIT_DSPCH_YN
				,	B.ST_STTN_NM
				,	B.ED_STTN_NM
				,	B.WAY_DIV
				
	FROM			BMS_COR_DTL_INFO A
		LEFT JOIN	BMS_ROUT_MST B
		ON			A.ROUT_ID = B.ROUT_ID
			
	WHERE			A.COR_ID = #{COR_ID}
	
	ORDER BY		A.ROUT_SN
	
</select>

<insert id="AL0103G1I0" parameterType="Map">
	INSERT INTO		BMS_COR_DTL_INFO
					(
						COR_ID
					,	ROUT_ID
					,	COR_DTL_COLOR
					,	REST_TM
					,	ROUT_SN
					,	UPD_DTM
					,	UPD_ID	
					)
	VALUES
					(
						#{COR_ID}
					,	#{ROUT_ID}
					,	#{COR_DTL_COLOR}
					,	#{REST_TM}
					,	#{ROUT_SN}
					,	#{UPD_DTM}
					,	#{SSN_USER_ID}	
					)			

</insert>

<update id="AL0103G1U0" parameterType="Map">
	UPDATE			BMS_COR_DTL_INFO
	
	SET				COR_DTL_COLOR = #{COR_DTL_COLOR}
					,REST_TM = #{REST_TM}
					,UPD_DTM = #{UPD_DTM}
					,UPD_ID	= #{SSN_USER_ID}
					
	WHERE			 COR_ID = #{COR_ID}
</update>

<delete id="AL0103G1D0" parameterType="Map">
	DELETE FROM		BMS_COR_DTL_INFO
	WHERE			COR_ID = #{COR_ID}
	AND				ROUT_ID = #{ROUT_ID}

</delete>

<select id="AL0103P0R0" resultType="Map">
	
	select ROUT_ID, ROUT_NM, ROUT_TYPE, STTN_CNT, ROUT_LEN, CURVATURE, REMARK
	from BMS_ROUT_MST
	<where>
		<if test="TYPE == 'ALL' and CONTENT != null and CONTENT != ''">
			AND ROUT_ID LIKE CONCAT('%',#{CONTENT},'%') || ROUT_NM LIKE CONCAT('%',#{CONTENT},'%') 
		</if>
		<if test="TYPE == 'ROUT_ID'">
			AND ROUT_ID LIKE CONCAT('%',#{CONTENT},'%')
		</if>
		<if test="TYPE == 'ROUT_NM'">
			AND ROUT_NM LIKE CONCAT('%',#{CONTENT},'%') 
		</if>
	</where>	
</select>

	<select id="AL0103P01R0" resultType="Map">
		SELECT  ROUT_ID,
				ROUT_GRP,
				DL8.DL_CD_NM AS ROUT_GRP_NM,
				INT_ROUT_ID,
				ROUT_NM,
				ROUT_TYPE,
				DL1.DL_CD_NM AS ROUT_TYPE_NM,
				ST_STTN_ID,
				ST_STTN_NM,
				ED_STTN_ID,
				ED_STTN_NM,
				RET_STTN_ID,
				RET_STTN_NM,
				ROUT_LEN,
				WAY_DIV,
				DL3.DL_CD_NM AS WAY_DIV_NM,
				USER_WAY_DIV,
				DL4.DL_CD_NM AS USER_WAY_DIV_NM
		FROM BMS_ROUT_MST A
		LEFT JOIN		BMS_DL_CD_INFO DL1
		ON				A.ROUT_TYPE = DL1.DL_CD AND DL1.CO_CD = 'ROUT_TYPE'
		LEFT JOIN		BMS_DL_CD_INFO DL3
		ON				A.WAY_DIV = DL3.DL_CD AND DL3.CO_CD = 'WAY_DIV'
		LEFT JOIN		BMS_DL_CD_INFO DL4
		ON				A.USER_WAY_DIV = DL4.DL_CD AND DL4.CO_CD = 'WAY_DIV'
		LEFT JOIN		BMS_DL_CD_INFO DL8
		ON				A.ROUT_GRP = DL8.DL_CD AND DL8.CO_CD = 'ROUT_GRP'
		<where>
			ROUT_GRP_NM = #{ROUT_GRP_NM}
			<if test="@kr.tracom.util.CommonUtil@notEmpty(CONTENT)">
				<if test="TYPE == 'ALL'">
					AND ROUT_ID LIKE CONCAT('%',#{CONTENT},'%') || ROUT_NM LIKE CONCAT('%',#{CONTENT},'%')
				</if>
				<if test="TYPE == 'ROUT_ID'">
					AND ROUT_ID LIKE CONCAT('%',#{CONTENT},'%')
				</if>
				<if test="TYPE == 'ROUT_NM'">
					AND ROUT_NM LIKE CONCAT('%',#{CONTENT},'%')
				</if>
			</if>
		</where>
		order by 
			ROUT_GRP_NM, WAY_DIV
	</select>

	<select id="AL0103P1SH" resultType="Map">
		SELECT 
			ROUT_ID, ROUT_NM, DL1.DL_CD_NM AS ROUT_GRP_NM
		FROM 
			BMS_ROUT_MST A
		LEFT JOIN		BMS_DL_CD_INFO DL1
		ON				A.ROUT_GRP = DL1.DL_CD AND DL1.CO_CD = 'ROUT_GRP'
		WHERE
			DL1.DL_CD_NM = #{ROUT_GRP_NM}
		ORDER BY 
			ROUT_NM
	</select>
</mapper>